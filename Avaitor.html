<!DOCTYPE html>
<html>
<head>
<title>Aviator</title>
<style>
body{
  background:#0f172a;
  color:white;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:#020617;
  padding:20px;
  border-radius:12px;
  width:330px;
  text-align:center;
}
#curve{
  height:120px;
  background:linear-gradient(135deg,#22c55e,#0ea5e9);
  border-radius:8px;
  position:relative;
  overflow:hidden;
}
#plane{
  position:absolute;
  bottom:10px;
  left:10px;
  font-size:24px;
}
#multi{font-size:28px;margin:10px}
.crash{color:red}
input,button{
  width:90%;
  padding:8px;
  margin:6px;
  border-radius:6px;
  border:none;
}
button{background:#22c55e;font-weight:bold}
.toggle{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
</style>
</head>

<body>
<div class="card">
<h2>‚úàÔ∏è Aviator</h2>
<p>Balance ‚Çπ<span id="bal">0</span></p>

<input type="number" id="bet" value="10" placeholder="Bet">

<div class="toggle">
  <input type="checkbox" id="autoToggle">
  <label>Auto Cashout</label>
</div>

<input type="number" id="autoValue" step="0.01" placeholder="Auto x (eg 1.50)">

<button onclick="start()">Start</button>
<button onclick="manualCashout()">Cashout</button>

<div id="curve">
  <div id="plane">‚úàÔ∏è</div>
</div>

<div id="multi">1.00x</div>
<p id="msg"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script>

<script>
let uid;
let balance = 0;
let betAmt = 0;
let multiplier = 1;
let interval;
let playing = false;
let cashedOut = false;
let adminCrashAt = 999;

firebase.auth().onAuthStateChanged(user=>{
  if(!user) return;
  uid=user.uid;

  firebase.database().ref("users/"+uid+"/balance")
    .on("value",s=>bal.innerText=s.val()||0);

  firebase.database().ref("admin/crashAt")
    .on("value",s=>{
      if(s.exists()) adminCrashAt=parseFloat(s.val());
    });
});

function start(){
  if(playing) return;
  betAmt = Number(bet.value);
  if(betAmt<=0) return alert("Invalid bet");

  playing=true;
  cashedOut=false;
  multiplier=1;
  multi.innerText="1.00x";
  msg.innerText="Flying...";
  multi.classList.remove("crash");

  interval=setInterval(()=>{
    multiplier += 0.02;
    multi.innerText = multiplier.toFixed(2)+"x";
    plane.style.transform =
      `translate(${multiplier*15}px,${-multiplier*6}px)`;

    /* üî• 1Ô∏è‚É£ ADMIN CRASH (TOP PRIORITY) */
    if(multiplier >= adminCrashAt){
      crash();
      return;
    }

    /* üí∞ 2Ô∏è‚É£ AUTO CASHOUT */
    if(
      !cashedOut &&
      autoToggle.checked &&
      Number(autoValue.value)>1 &&
      multiplier >= Number(autoValue.value)
    ){
      doCashout("Auto");
    }

  },100);
}

function doCashout(type){
  cashedOut=true;
  let win = Math.floor(betAmt * multiplier);
  updateBalance(win);
  msg.innerText = `‚úÖ ${type} Cashout ‚Çπ${win}`;
}

function manualCashout(){
  if(!playing || cashedOut) return;
  doCashout("Manual");
  endGame();
}

function crash(){
  multi.classList.add("crash");
  msg.innerText="üí• CRASHED!";
  if(!cashedOut){
    updateBalance(-betAmt);
  }
  endGame();
}

function endGame(){
  clearInterval(interval);
  playing=false;
}

function updateBalance(amount){
  const ref = firebase.database().ref("users/"+uid+"/balance");
  ref.once("value").then(s=>{
    ref.set((s.val()||0)+amount);
  });
}
</script>
</body>
</html>
