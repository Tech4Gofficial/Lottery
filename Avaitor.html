<!DOCTYPE html>
<html>
<head>
<title>Aviator</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
<h2>âœˆï¸ Aviator</h2>
<p>Balance â‚¹<span id="bal">0</span></p>
<p>Status: <span id="status"></span></p>
<p>Countdown: <span id="count"></span></p>

<input type="number" id="bet" placeholder="Bet Amount">
<button onclick="placeBet()">Place Bet</button>
<button onclick="cashout()">Cashout</button>

<h1 id="multi">1.00x</h1>
<p id="msg"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script>

<script>
let uid;
let currentRound=0;
let flying=false;
let multiplier=1;

firebase.auth().onAuthStateChanged(u=>{
  if(!u) return location.href="index.html";
  uid=u.uid;

  firebase.database().ref("users/"+uid+"/balance")
    .on("value",s=>bal.innerText=s.val());

  firebase.database().ref("admin").on("value",s=>{
    const d=s.val();
    status.innerText=d.status;
    count.innerText=d.countdown;
    currentRound=d.roundId;

    if(d.status==="flying" && !flying){
      startPlane();
    }
  });
});

function placeBet(){
  firebase.database().ref(`bets/round_${currentRound}/${uid}`).set({
    bet:Number(bet.value),
    cashedOut:false
  });
}

function startPlane(){
  flying=true;
  multiplier=1;
  let fly=setInterval(()=>{
    multiplier+=0.01;
    multi.innerText=multiplier.toFixed(2)+"x";

    firebase.database().ref("admin/status").once("value").then(s=>{
      if(s.val()==="crashed"){
        clearInterval(fly);
        flying=false;
        msg.innerText="ğŸ’¥ CRASHED";
      }
    });
  },150);
}

function cashout(){
  firebase.database().ref(`bets/round_${currentRound}/${uid}`).once("value").then(s=>{
    if(!s.exists()) return;
    let profit=Math.floor(s.val().bet*(multiplier-1));
    firebase.database().ref("users/"+uid+"/balance")
      .transaction(b=>b+profit);
    msg.innerText="âœ… Cashed Out";
  });
}
</script>
</body>
</html>
