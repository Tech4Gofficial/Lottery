<!DOCTYPE html>
<html>
<head>
<title>Aviator</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
<h2>✈️ Aviator</h2>

<p>Round: <span id="round">1</span></p>
<p>Status: <span id="status">waiting</span></p>
<p>Countdown: <span id="count">--</span></p>

<div id="multi">1.00x</div>
<p id="msg"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script>

<script>
let multiplier = 1;
let flying = false;
let crashAt = 999;
let loop;

firebase.database().ref("admin").on("value", snap=>{
  const d = snap.val();
  document.getElementById("count").innerText = d.countdown;
  document.getElementById("round").innerText = d.roundId;
  document.getElementById("status").innerText = d.status;
  crashAt = d.crashAt;

  if(d.status === "flying" && !flying){
    startFlight();
  }
});

function startFlight(){
  flying = true;
  multiplier = 1;
  loop = setInterval(()=>{
    multiplier += 0.01;
    multi.innerText = multiplier.toFixed(2)+"x";
    if(multiplier >= crashAt){
      crash();
    }
  },200);
}

function crash(){
  clearInterval(loop);
  flying = false;
  multi.classList.add("crash");
  msg.innerText = "CRASHED!";
}
</script>
</body>
</html>
