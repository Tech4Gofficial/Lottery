<!DOCTYPE html>
<html>
<head>
  <title>Color Bet</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
  <h2>ðŸŽ¨ Color Bet</h2>
  <p>Balance: â‚¹<span id="bal">0</span></p>

  <input id="bet" type="number" placeholder="Bet Amount"><br>
  <button class="red" onclick="play('red')">Red 2x</button>
  <button class="green" onclick="play('green')">Green 2x</button>
  <button class="violet" onclick="play('violet')">Violet 5x</button>

  <p id="res"></p>
  <a href="games.html">â¬… Back to Games</a><br><br>
  <button onclick="logout()">Logout</button>
</div>

<script src="firebase.js"></script>
<script>
let uid;
firebase.auth().onAuthStateChanged(user=>{
  if(!user){ location.href="index.html"; return; }
  uid=user.uid;
  firebase.database().ref("users/"+uid+"/balance")
    .on("value", snap => bal.innerText = snap.val());
});

function play(choice){
  let betAmt = Number(bet.value);
  let colors = ["red","green","violet","red","green"];
  let result = colors[Math.floor(Math.random()*5)];
  res.classList.add("flash");

  firebase.database().ref("users/"+uid+"/balance").once("value").then(snap=>{
    let bal = snap.val();
    if(bal < betAmt) return alert("Low balance");

    if(choice === result){
      let win = choice==="violet"? betAmt*5 : betAmt*2;
      firebase.database().ref("users/"+uid+"/balance").set(bal + win);
      res.innerText = "ðŸŽ‰ "+result+" WIN â‚¹"+win;
    } else {
      firebase.database().ref("users/"+uid+"/balance").set(bal - betAmt);
      res.innerText = "âŒ "+result+" LOST";
    }
  });
}

function logout(){
  firebase.auth().signOut();
  location.href = "index.html";
}
</script>
</body>
</html>
