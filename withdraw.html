<!DOCTYPE html>
<html>
<head>
<title>Withdraw</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
<h2>ðŸ’¸ Withdraw</h2>

<p class="balance">Balance â‚¹<span id="bal">0</span></p>

<input id="upi" placeholder="Enter UPI ID"><br>
<input id="amount" type="number" placeholder="Withdraw Amount"><br>

<button onclick="submitWithdraw()">Withdraw</button>

<p id="msg"></p>
<a href="games.html">â¬… Back</a>
</div>

<script src="firebase.js"></script>
<script>
let uid, fixedUpi=null;

firebase.auth().onAuthStateChanged(u=>{
 if(!u) location="index.html";
 uid=u.uid;

 firebase.database().ref("users/"+uid).once("value", s=>{
  bal.innerText = s.val().balance || 0;
  if(s.val().upi){
   fixedUpi = s.val().upi;
   upi.value = fixedUpi;
   upi.disabled = true;
  }
 });
});

function submitWithdraw(){
 let amt = Number(amount.value);
 let upiId = upi.value.trim();

 if(amt < 110 || amt > 5000)
  return msg.innerText="âŒ Withdraw must be â‚¹110â€“â‚¹5000";

 if(!upiId.includes("@"))
  return msg.innerText="âŒ Invalid UPI ID";

 firebase.database().ref("users/"+uid+"/balance").once("value", s=>{
  if(s.val() < amt)
   return msg.innerText="âŒ Insufficient balance";

  if(!fixedUpi){
   firebase.database().ref("users/"+uid+"/upi").set(upiId);
  }

  firebase.database().ref("withdraws/"+uid).push({
   amount: amt,
   upi: upiId,
   status: "pending",
   time: Date.now()
  });

  msg.innerText="âœ… Withdraw request submitted";
  amount.value="";
 });
}
</script>

</body>
</html>
