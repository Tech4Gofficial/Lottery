<!DOCTYPE html>
<html>
<body>

<h2>‚úàÔ∏è Aviator</h2>
<p>Balance: ‚Çπ<span id="bal">0</span></p>

<input id="bet" type="number" placeholder="Bet amount"><br><br>
<button onclick="start()">Start</button>
<button onclick="cashout()">Cashout</button>

<h3 id="multi">1.00x</h3>
<p id="msg"></p>

<a href="games.html">‚¨Ö Back</a>

<script src="firebase.js"></script>
<script>
let uid, interval, multiplier=1, crashed=false, betAmt=0;

firebase.auth().onAuthStateChanged(u=>{
  uid=u.uid;
  firebase.database().ref("users/"+uid+"/balance")
    .on("value", s=>bal.innerText=s.val());
});

function start(){
  betAmt = Number(bet.value);
  multiplier=1;
  crashed=false;
  msg.innerText="‚úàÔ∏è Flying...";
  clearInterval(interval);

  interval=setInterval(()=>{
    multiplier += 0.05;
    multi.innerText = multiplier.toFixed(2)+"x";
    if(Math.random()<0.03){
      crash();
    }
  },100);
}

function cashout(){
  if(crashed) return;
  let win = Math.floor(betAmt * multiplier);
  update(win);
  msg.innerText="üí∞ Cashed out ‚Çπ"+win;
  clearInterval(interval);
}

function crash(){
  crashed=true;
  msg.innerText="üí• Crashed!";
  update(-betAmt);
  clearInterval(interval);
}

function update(amount){
  let ref=firebase.database().ref("users/"+uid+"/balance");
  ref.once("value", s=>{
    ref.set(s.val()+amount);
  });
}
</script>

</body>
</html>
