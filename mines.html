<!DOCTYPE html>
<html>
<head>
  <title>Mines</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
  <h2>ðŸ’£ Mines</h2>
  <p>Balance: â‚¹<span id="bal">0</span></p>

  <button onclick="start()">Start (â‚¹10)</button>
  <div id="grid"></div>
  <p id="msg"></p>
  <button onclick="cashout()">Cashout</button>

  <a href="games.html">â¬… Back to Games</a><br><br>
  <button onclick="logout()">Logout</button>
</div>

<script src="firebase.js"></script>
<script>
let uid, mine, win=10, opened=0;

firebase.auth().onAuthStateChanged(user=>{
  if(!user) { location.href="index.html"; return; }
  uid = user.uid;

  firebase.database().ref("users/"+uid+"/balance")
    .on("value", snap => bal.innerText = snap.val());
});

function start(){
  mine = Math.floor(Math.random()*5);
  win = 10; opened = 0;
  grid.innerHTML = "";
  msg.innerText = "Pick a tile";

  for(let i=0;i<5;i++){
    let b=document.createElement("button");
    b.innerText = "â“";
    b.onclick = ()=> openTile(i,b);
    grid.appendChild(b);
  }
}

function openTile(i,btn){
  if(i===mine){
    btn.innerText = "ðŸ’¥"; btn.classList.add("bomb");
    msg.innerText = "Mine hit! Lost â‚¹10";
    update(-10);
    grid.innerHTML = "";
  } else {
    btn.innerText="ðŸ’Ž"; btn.classList.add("safe"); btn.disabled=true;
    opened++; win+=5;
    msg.innerText = "Safe! Cashout â‚¹"+win;
  }
}

function cashout(){
  if(opened>0){
    update(win);
    msg.innerText = "Cashed out â‚¹"+win;
    grid.innerHTML = "";
  }
}

function update(amount){
  firebase.database().ref("users/"+uid+"/balance")
    .once("value", snap => {
      firebase.database().ref("users/"+uid+"/balance").set(snap.val() + amount);
    });
}

function logout(){
  firebase.auth().signOut();
  location.href = "index.html";
}
</script>
</body>
</html>
