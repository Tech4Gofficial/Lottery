<!DOCTYPE html>
<html>
<head>
<title>Mines</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
<h2>ðŸ’£ Mines</h2>
<p class="balance">Balance â‚¹<span id="bal">0</span></p>

<button onclick="start()">Start (â‚¹10)</button>
<div id="grid"></div>
<p id="msg"></p>
<button onclick="cashout()">Cashout</button>

<a href="games.html">â¬… Back</a>
</div>

<script src="firebase.js"></script>
<script>
let uid, mine, win=10, opened=0;

firebase.auth().onAuthStateChanged(u=>{
 uid=u.uid;
 firebase.database().ref("users/"+uid+"/balance")
  .on("value",s=>bal.innerText=s.val());
});

function start(){
 mine=Math.floor(Math.random()*5);
 win=10;opened=0;grid.innerHTML="";msg.innerText="Pick tiles";
 for(let i=0;i<5;i++){
  let b=document.createElement("button");
  b.innerText="â“";
  b.onclick=()=>openTile(i,b);
  grid.appendChild(b);
 }
}

function openTile(i,b){
 if(i===mine){
  msg.innerText="ðŸ’¥ Mine! Lost â‚¹10";
  update(-10);grid.innerHTML="";
 }else{
  b.innerText="ðŸ’Ž";b.disabled=true;
  opened++;win+=5;
  msg.innerText="Safe! Cashout â‚¹"+win;
 }
}

function cashout(){
 if(opened>0){update(win);msg.innerText="ðŸ’° Won â‚¹"+win;grid.innerHTML="";}
}

function update(a){
 let r=firebase.database().ref("users/"+uid+"/balance");
 r.once("value",s=>r.set(s.val()+a));
}
</script>

</body>
</html>
