<!DOCTYPE html>
<html>
<body>

<h2>ðŸ’£ Mines Game</h2>
<p>Bet: â‚¹10 | 1 Mine | 5 Tiles</p>
<p>Balance: â‚¹<span id="bal">0</span></p>

<button onclick="start()">Start Game</button>
<div id="grid"></div>
<p id="msg"></p>
<button onclick="cashout()">Cashout</button>

<a href="games.html">â¬… Back</a>

<script src="firebase.js"></script>
<script>
let mine, opened = 0, win = 10, uid;

firebase.auth().onAuthStateChanged(u=>{
  uid = u.uid;
  firebase.database().ref("users/"+uid+"/balance")
    .on("value", s => bal.innerText = s.val());
});

function start(){
  mine = Math.floor(Math.random()*5);
  opened = 0;
  win = 10;
  grid.innerHTML = "";
  msg.innerText = "Game started";

  for(let i=0;i<5;i++){
    let b = document.createElement("button");
    b.innerText = "â“";
    b.onclick = () => openTile(i,b);
    grid.appendChild(b);
  }
}

function openTile(i,btn){
  if(i === mine){
    msg.innerText = "ðŸ’¥ Mine! You lost â‚¹10";
    update(-10);
    grid.innerHTML="";
  } else {
    btn.innerText="ðŸ’Ž";
    opened++;
    win += 5;
    msg.innerText = "Safe! Potential win â‚¹"+win;
    btn.disabled=true;
  }
}

function cashout(){
  if(opened>0){
    update(win);
    msg.innerText="ðŸ’° Cashed out â‚¹"+win;
    grid.innerHTML="";
  }
}

function update(amount){
  let ref = firebase.database().ref("users/"+uid+"/balance");
  ref.once("value", s=>{
    ref.set(s.val()+amount);
  });
}
</script>

</body>
</html>
