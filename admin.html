<!DOCTYPE html>
<html>
<head>
<title>Admin Aviator</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
<h2>ADMIN PANEL</h2>

<p>Round: <span id="round">1</span></p>
<p>Status: <span id="status">waiting</span></p>
<p>Countdown: <span id="cd">10</span></p>

<input type="number" id="crashAt" step="0.01" placeholder="Crash At (eg 1.50)">
<button onclick="setCrash()">Set Crash</button>

<button onclick="startCountdown()">Start Countdown</button>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script>

<script>
let countdownTimer = null;

const adminRef = firebase.database().ref("admin");

adminRef.on("value", s=>{
  const d = s.val();
  round.innerText = d.roundId;
  status.innerText = d.status;
  cd.innerText = d.countdown;
});

function setCrash(){
  adminRef.update({
    crashAt: Number(document.getElementById("crashAt").value)
  });
}

function startCountdown(){
  clearInterval(countdownTimer);

  adminRef.update({
    status: "waiting",
    countdown: 10
  });

  countdownTimer = setInterval(()=>{
    adminRef.once("value").then(s=>{
      let d = s.val();
      if(d.countdown <= 0){
        clearInterval(countdownTimer);
        adminRef.update({ status:"flying" });
        startFlight();
        return;
      }
      adminRef.update({ countdown: d.countdown - 1 });
    });
  },1000);
}

function startFlight(){
  // flight duration handled on user side
}
</script>
</body>
</html>
